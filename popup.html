<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Popup</title>
    <style>
            /* app shell CSS */
            :root {
            --gray: #ececec;
            --whitesmoke: #f5f5f5;
            --dark: #222;
        }

        body {
            margin: 0;
            background-color: var(--whitesmoke);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans",
                "Helvetica Neue", sans-serif;
        }
    </style>
</head>

<body>
    <form id="login">
        <input type="text" name="username" id="username">
        <input type="password" name="password" id="password">
        <button type="submit">Log in</button>
    </form>
    <script type="text/javascript">
        const loginForm = document.querySelector('#login');

        async function login(event) {
            event.preventDefault();
            const username = document.querySelector("#username").value;
            const password = document.querySelector("#password").value;

            const res = await fetch('/gleecall.api/backend?username=' + username + '&password=' + password, {
                mode: 'cors'
            });
            const json = await res.json();
            window.opener.postMessage(json, "http://localhost");
            window.close();
        };

        loginForm.addEventListener('submit', (event) => {
            login(event);
        });

        // window.opener.postMessage({
        //     token: 'aaa',
        //     secret: 'bbb'
        // }, 'http://localhost:8080');
    </script>

</body>

</html>